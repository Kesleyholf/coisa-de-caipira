<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coisa de Caipira Alimentos - Produtos da Roça</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto+Slab:wght@300;400;500&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
    <style>
        /* [Seu CSS existente permanece o mesmo] */
    </style>
</head>
<body>
    <!-- [Seu HTML existente permanece o mesmo até a seção de scripts] -->

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyADdZbV9CvD6EO3TXY4FsV-4WRxZLkjuNw",
            authDomain: "coisa-de-caipira.firebaseapp.com",
            projectId: "coisa-de-caipira",
            storageBucket: "coisa-de-caipira.appspot.com",
            messagingSenderId: "784075359586",
            appId: "1:784075359586:web:3b8902f0811e6117c4583b"
        };

        // Inicialização do Firebase
        try {
            const app = firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();
            const auth = firebase.auth();
            const storage = firebase.storage();
            console.log("Firebase conectado com sucesso!");
        } catch (error) {
            console.error("Erro ao conectar Firebase:", error);
        }

        // Variáveis globais
        let currentUser = null;
        let cart = [];
        let currentOrderId = null;
        let loginType = 'user'; // 'user' ou 'admin'
        const MAX_ADMINS = 2; // Número máximo de administradores permitidos
        const ADMIN_EMAILS = [
            "admin1@coisadecaipira.com",
            "admin2@coisadecaipira.com"
        ]; // Emails dos administradores permitidos

        // [Outras funções existentes permanecem as mesmas até loadProducts()]

        // Carregar produtos do Firebase
        function loadProducts() {
            db.collection("products").get()
                .then((querySnapshot) => {
                    const container = document.getElementById('productsContainer');
                    container.innerHTML = '';
                    
                    if (querySnapshot.empty) {
                        container.innerHTML = `
                            <div class="col-12 text-center py-5">
                                <i class="bi bi-exclamation-triangle fs-1 text-warning"></i>
                                <h3 class="mt-3">Nenhum produto cadastrado</h3>
                                <p>Nossos produtos estarão disponíveis em breve</p>
                            </div>
                        `;
                        return;
                    }

                    let delay = 1;
                    querySnapshot.forEach((doc) => {
                        const product = doc.data();
                        const col = document.createElement('div');
                        col.className = `col-md-4 mb-4 animate-fadeIn delay-${delay}`;
                        
                        col.innerHTML = `
                            <div class="card h-100">
                                <img src="${product.imageUrl || 'https://via.placeholder.com/300'}" 
                                     class="card-img-top" 
                                     alt="${product.name}"
                                     style="height: 200px; object-fit: cover;">
                                <div class="card-body">
                                    <h5 class="card-title">
                                        <i class="bi bi-flower1 text-success"></i> ${product.name}
                                    </h5>
                                    <p class="card-text">${product.description || 'Descrição não disponível'}</p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="h5 text-success">R$ ${product.price?.toFixed(2) || '0,00'}</span>
                                        <button class="btn btn-sm btn-outline-success" onclick="addToCart('${doc.id}')">
                                            <i class="bi bi-cart-plus"></i> Adicionar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        container.appendChild(col);
                        delay = delay === 3 ? 1 : delay + 1;
                    });
                })
                .catch((error) => {
                    console.error("Erro ao carregar produtos:", error);
                    const container = document.getElementById('productsContainer');
                    container.innerHTML = `
                        <div class="col-12 text-center py-5">
                            <i class="bi bi-exclamation-octagon fs-1 text-danger"></i>
                            <h3 class="mt-3">Erro ao carregar produtos</h3>
                            <p>Por favor, tente recarregar a página</p>
                        </div>
                    `;
                });
        }

        // [Funções existentes permanecem as mesmas até a função de login]

        // Manipulação do formulário de login
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Verificar se é um email de admin permitido
            if (loginType === 'admin' && !ADMIN_EMAILS.includes(email)) {
                Swal.fire({
                    icon: 'error',
                    title: 'Acesso negado',
                    text: 'Este email não tem permissão de administrador'
                });
                return;
            }

            // Autenticação com Firebase
            firebase.auth().signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    currentUser = userCredential.user;
                    
                    // Verificar se é admin
                    return db.collection('users').doc(userCredential.user.uid).get();
                })
                .then(userDoc => {
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        
                        // Verificar limite de administradores
                        if (loginType === 'admin' && userData.type === 'admin') {
                            return db.collection('users')
                                .where('type', '==', 'admin')
                                .get()
                                .then((adminSnapshot) => {
                                    if (adminSnapshot.size > MAX_ADMINS) {
                                        throw new Error(`Limite de ${MAX_ADMINS} administradores atingido`);
                                    }
                                    return userData;
                                });
                        }
                        return userData;
                    } else {
                        throw new Error('Usuário não encontrado');
                    }
                })
                .then(userData => {
                    if (loginType === 'admin' && userData.type === 'admin') {
                        // Esconder a área pública e mostrar a área admin
                        document.querySelector('body > :not(#adminArea)').style.display = 'none';
                        document.getElementById('adminArea').style.display = 'block';
                        
                        // Carregar dados administrativos
                        loadAdminDashboard();
                    }
                    
                    Swal.fire({
                        icon: 'success',
                        title: 'Login realizado com sucesso!',
                        timer: 2000
                    });
                    
                    const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
                    loginModal.hide();
                })
                .catch((error) => {
                    Swal.fire({
                        icon: 'error',
                        title: 'Erro',
                        text: error.message
                    });
                });
        });

        // [Restante do seu código JavaScript permanece o mesmo]

        // Inicialização da página
        document.addEventListener('DOMContentLoaded', function() {
            // Carregar produtos
            loadProducts();
            
            // Carregar configurações de redes sociais
            loadSocialMediaSettings();
            
            // Configurar animações
            const animateElements = document.querySelectorAll('.animate-fadeIn');
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = 1;
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, { threshold: 0.1 });
            
            animateElements.forEach(el => {
                el.style.opacity = 0;
                el.style.transform = 'translateY(20px)';
                el.style.transition = 'opacity 0.8s ease, transform 0.8s ease';
                observer.observe(el);
            });
        });
    </script>
</body>
</html>
